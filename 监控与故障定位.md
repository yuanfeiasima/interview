# ç›‘æ§ä¸æ•…éšœå®šä½

## æ ¸å¿ƒè¦ç‚¹ï¼ˆé¢è¯•å¿«é€Ÿå›ç­”ï¼‰

**Q: å…·ä½“ç›‘æ§å“ªäº›æŒ‡æ ‡ï¼Ÿ**
å››ç±»æ ¸å¿ƒæŒ‡æ ‡ï¼š1ï¼‰æµé‡æŒ‡æ ‡ï¼šQPSã€è¯·æ±‚é‡ã€æµé‡åˆ†å¸ƒï¼›2ï¼‰æ€§èƒ½æŒ‡æ ‡ï¼šRTï¼ˆP50/P99ï¼‰ã€ååé‡ã€é˜Ÿåˆ—é•¿åº¦ï¼›3ï¼‰é”™è¯¯æŒ‡æ ‡ï¼šé”™è¯¯ç‡ã€é”™è¯¯ç±»å‹åˆ†å¸ƒã€å¼‚å¸¸æ•°ï¼›4ï¼‰èµ„æºæŒ‡æ ‡ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€è¿æ¥æ•°ã€‚æ¯ç±»æŒ‡æ ‡éƒ½æœ‰åŸºçº¿å’Œå‘Šè­¦é˜ˆå€¼ã€‚

**Q: å‘Šè­¦é˜ˆå€¼å¦‚ä½•è®¾ç½®ï¼Ÿ**
åŸºäºå†å²æ•°æ®åŠ¨æ€è®¾ç½®ã€‚é™æ€é˜ˆå€¼+åŠ¨æ€é˜ˆå€¼ç»“åˆï¼šé™æ€é˜ˆå€¼ç”¨äºä¿åº•ï¼ˆå¦‚é”™è¯¯ç‡>5%å¿…æŠ¥è­¦ï¼‰ï¼ŒåŠ¨æ€é˜ˆå€¼åŸºäºè¿‡å»7å¤©åŒæ—¶æ®µå‡å€¼ï¼ˆåç¦»>50%å‘Šè­¦ï¼‰ã€‚è¿˜æœ‰ç¯æ¯”å‘Šè­¦ï¼šä¸ä¸Šä¸€å°æ—¶å¯¹æ¯”å˜åŒ–>30%å‘Šè­¦ã€‚

**Q: å¦‚ä½•é¿å…å‘Šè­¦é£æš´ï¼Ÿ**
ä¸‰ç§æ–¹å¼ï¼š1ï¼‰å‘Šè­¦èšåˆï¼šåŒç±»å‘Šè­¦5åˆ†é’Ÿå†…åªå‘ä¸€æ¡ï¼›2ï¼‰å‘Šè­¦åˆ†çº§ï¼šP0-P3åˆ†çº§ï¼ŒP0ç”µè¯é€šçŸ¥ï¼ŒP3åªè®°å½•ï¼›3ï¼‰å‘Šè­¦æ”¶æ•›ï¼šä¸Šæ¸¸æ•…éšœå¯¼è‡´çš„ä¸‹æ¸¸å‘Šè­¦è‡ªåŠ¨å…³è”ï¼Œåªé€šçŸ¥æ ¹å› ã€‚

**Q: é‡åˆ°è¿‡æœ€éš¾å®šä½çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ**
å¶å‘çš„P99æ¯›åˆºé—®é¢˜ã€‚å¹³å‡RTæ­£å¸¸ä½†P99å¶å°”é£™å‡ã€‚æ’æŸ¥å‘ç°æ˜¯JVM GCåœé¡¿å¯¼è‡´çš„ã€‚é€šè¿‡åˆ†æGCæ—¥å¿—å’Œç«ç„°å›¾å®šä½åˆ°æ˜¯å¤§å¯¹è±¡åˆ†é…å¼•èµ·çš„Full GCã€‚ä¼˜åŒ–åé—®é¢˜è§£å†³ã€‚

---

## ä¸€ã€ç›‘æ§ä½“ç³»æ¦‚è§ˆ

### 1.1 ç›‘æ§æ¶æ„

```
ç›‘æ§æ•°æ®æµï¼š

åº”ç”¨å±‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸šåŠ¡æŒ‡æ ‡ã€è°ƒç”¨é“¾ã€æ—¥å¿—                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é‡‡é›†å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚Prometheusâ”‚  â”‚SkyWalkingâ”‚  â”‚  ELK   â”‚              â”‚
â”‚  â”‚ (æŒ‡æ ‡)   â”‚  â”‚ (é“¾è·¯)   â”‚  â”‚ (æ—¥å¿—)  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å­˜å‚¨å±‚                              â”‚
â”‚  InfluxDB/VictoriaMetrics  â”‚  ES  â”‚  ClickHouse      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å±•ç¤ºå±‚                              â”‚
â”‚      Grafana      â”‚    Kibana    â”‚    è‡ªç ”å¤§ç›˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‘Šè­¦å±‚                              â”‚
â”‚      AlertManager   â”‚   PagerDuty   â”‚   ä¼ä¸šå¾®ä¿¡       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ç›‘æ§ç»´åº¦

| ç›‘æ§å±‚æ¬¡ | å…³æ³¨ç‚¹ | æ ¸å¿ƒæŒ‡æ ‡ |
|---------|-------|---------|
| ä¸šåŠ¡å±‚ | ä¸šåŠ¡å¥åº·åº¦ | ä¸‹å•æˆåŠŸç‡ã€è½¬åŒ–ç‡ã€GMV |
| åº”ç”¨å±‚ | æœåŠ¡å¥åº·åº¦ | QPSã€RTã€é”™è¯¯ç‡ |
| ä¸­é—´ä»¶å±‚ | ç»„ä»¶çŠ¶æ€ | ç¼“å­˜å‘½ä¸­ç‡ã€MQå †ç§¯ã€DBè¿æ¥ |
| åŸºç¡€è®¾æ–½å±‚ | èµ„æºçŠ¶æ€ | CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ |

---

## äºŒã€æ ¸å¿ƒç›‘æ§æŒ‡æ ‡

### 2.1 æµé‡æŒ‡æ ‡

**æµé‡ç›‘æ§çš„ä»·å€¼**ï¼šæµé‡æ˜¯ç³»ç»Ÿå¥åº·çš„æ™´é›¨è¡¨ã€‚QPSçªå¢å¯èƒ½æ˜¯è¢«æ”»å‡»æˆ–æ´»åŠ¨å¼€å§‹ï¼ŒQPSéª¤é™å¯èƒ½æ˜¯ç³»ç»Ÿæ•…éšœæˆ–ä¸Šæ¸¸å‡ºé—®é¢˜ã€‚é€šè¿‡ç›‘æ§æµé‡å˜åŒ–ï¼Œå¯ä»¥ç¬¬ä¸€æ—¶é—´å‘ç°å¼‚å¸¸ã€‚

**æŒ‡æ ‡è®¾è®¡è¦ç‚¹**ï¼š
- æ‰“ä¸Šmethod/uri/statusæ ‡ç­¾ï¼Œä¾¿äºç»†åˆ†åˆ†æ
- æ—¢è¦ç»Ÿè®¡ç´¯è®¡å€¼ï¼ˆtotalï¼‰ï¼Œä¹Ÿè¦ç»Ÿè®¡ç¬æ—¶å€¼ï¼ˆcurrent_qpsï¼‰

```java
// æµé‡æŒ‡æ ‡é‡‡é›†
public class TrafficMetrics {

    private Counter requestTotal = Counter.builder()
        .name("http_requests_total")
        .tag("method", "GET")
        .tag("uri", "/api/product")
        .tag("status", "200")
        .description("Total HTTP requests")
        .register(registry);

    private Gauge currentQps = Gauge.builder()
        .name("http_current_qps")
        .description("Current QPS")
        .register(registry);

    // è®°å½•è¯·æ±‚
    public void recordRequest(String method, String uri, int status) {
        requestTotal.increment();
    }
}
```

**æ ¸å¿ƒæµé‡æŒ‡æ ‡ï¼š**
```
1. QPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰
   - å…¨å±€QPS
   - æ¥å£çº§QPS
   - å•†å®¶çº§QPS

2. æµé‡åˆ†å¸ƒ
   - æŒ‰åœ°åŸŸåˆ†å¸ƒ
   - æŒ‰æ—¶é—´åˆ†å¸ƒ
   - æŒ‰æ¥å£åˆ†å¸ƒ

3. æµé‡è¶‹åŠ¿
   - åŒæ¯”ï¼ˆä¸ä¸Šå‘¨åŒæœŸï¼‰
   - ç¯æ¯”ï¼ˆä¸ä¸Šä¸€å°æ—¶ï¼‰
```

### 2.2 æ€§èƒ½æŒ‡æ ‡

**ä¸ºä»€ä¹ˆè¦å…³æ³¨P99è€Œä¸åªæ˜¯å¹³å‡å€¼**ï¼šå¹³å‡å€¼å¯èƒ½æ©ç›–é—®é¢˜ã€‚æ¯”å¦‚99%è¯·æ±‚10msï¼Œ1%è¯·æ±‚1000msï¼Œå¹³å‡å€¼æ˜¯19.9msçœ‹èµ·æ¥ä¸é”™ï¼Œä½†1%ç”¨æˆ·ä½“éªŒå¾ˆå·®ã€‚P99ï¼ˆç¬¬99ç™¾åˆ†ä½ï¼‰èƒ½å‘ç°è¿™ç§é•¿å°¾å»¶è¿Ÿé—®é¢˜ã€‚

**æŒ‡æ ‡è¯´æ˜**ï¼š
- P50ï¼šä¸­ä½æ•°ï¼Œä¸€åŠç”¨æˆ·æ¯”è¿™å¿«
- P90ï¼š90%ç”¨æˆ·æ¯”è¿™å¿«
- P99ï¼š99%ç”¨æˆ·æ¯”è¿™å¿«ï¼Œåæ˜ é•¿å°¾
- Maxï¼šæœ€æ…¢çš„è¯·æ±‚ï¼Œå¯èƒ½æ˜¯æç«¯æƒ…å†µ

```java
// æ€§èƒ½æŒ‡æ ‡é‡‡é›†
public class PerformanceMetrics {

    private Timer responseTime = Timer.builder()
        .name("http_response_time")
        .tag("uri", "/api/product")
        .publishPercentiles(0.5, 0.9, 0.99)  // P50, P90, P99
        .register(registry);

    // è®°å½•å“åº”æ—¶é—´
    public void recordResponseTime(String uri, long duration) {
        responseTime.record(duration, TimeUnit.MILLISECONDS);
    }
}
```

**æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡ï¼š**
```
1. å“åº”æ—¶é—´
   - P50ï¼ˆä¸­ä½æ•°ï¼‰ï¼šåæ˜ å…¸å‹ç”¨æˆ·ä½“éªŒ
   - P90ï¼šåæ˜ å¤§å¤šæ•°ç”¨æˆ·ä½“éªŒ
   - P99ï¼šåæ˜ é•¿å°¾å»¶è¿Ÿ
   - Maxï¼šåæ˜ æœ€å·®æƒ…å†µ

2. ååé‡
   - æ¯ç§’å¤„ç†è¯·æ±‚æ•°
   - æ¯ç§’å¤„ç†æ•°æ®é‡

3. å¹¶å‘åº¦
   - æ´»è·ƒè¿æ¥æ•°
   - çº¿ç¨‹æ± ä½¿ç”¨ç‡
   - é˜Ÿåˆ—é•¿åº¦
```

### 2.3 é”™è¯¯æŒ‡æ ‡

```java
// é”™è¯¯æŒ‡æ ‡é‡‡é›†
public class ErrorMetrics {

    private Counter errorTotal = Counter.builder()
        .name("http_errors_total")
        .tag("uri", "/api/product")
        .tag("type", "TIMEOUT")  // TIMEOUT, DB_ERROR, BIZ_ERRORç­‰
        .register(registry);

    // é”™è¯¯ç‡è®¡ç®—
    public double getErrorRate(String uri, Duration window) {
        long totalRequests = getTotalRequests(uri, window);
        long errorRequests = getErrorRequests(uri, window);

        if (totalRequests == 0) return 0;
        return (double) errorRequests / totalRequests;
    }
}
```

**æ ¸å¿ƒé”™è¯¯æŒ‡æ ‡ï¼š**
```
1. é”™è¯¯ç‡
   - æ•´ä½“é”™è¯¯ç‡
   - æ¥å£çº§é”™è¯¯ç‡
   - é”™è¯¯ç±»å‹åˆ†å¸ƒ

2. å¼‚å¸¸æ•°
   - æŒ‰å¼‚å¸¸ç±»å‹ç»Ÿè®¡
   - æŒ‰æ—¶é—´è¶‹åŠ¿ç»Ÿè®¡

3. é”™è¯¯è¯¦æƒ…
   - é”™è¯¯å †æ ˆ
   - é”™è¯¯ä¸Šä¸‹æ–‡
```

### 2.4 èµ„æºæŒ‡æ ‡

```
1. CPU
   - ä½¿ç”¨ç‡ï¼ˆuser/system/iowaitï¼‰
   - è´Ÿè½½ï¼ˆload averageï¼‰

2. å†…å­˜
   - ä½¿ç”¨ç‡
   - JVMå †å†…å­˜ï¼ˆEden/Survivor/Oldï¼‰
   - GCé¢‘ç‡å’Œè€—æ—¶

3. ç£ç›˜
   - ä½¿ç”¨ç‡
   - IOç­‰å¾…
   - è¯»å†™é€Ÿåº¦

4. ç½‘ç»œ
   - å¸¦å®½ä½¿ç”¨ç‡
   - è¿æ¥æ•°
   - åŒ…é‡
```

---

## ä¸‰ã€å‘Šè­¦é˜ˆå€¼è®¾ç½®

### 3.1 é™æ€é˜ˆå€¼

```yaml
# é™æ€å‘Šè­¦è§„åˆ™
alerts:
  # é”™è¯¯ç‡å‘Šè­¦
  - alert: HighErrorRate
    expr: http_error_rate > 0.05
    for: 5m
    labels:
      severity: P0
    annotations:
      summary: "é”™è¯¯ç‡è¶…è¿‡5%"

  # RTå‘Šè­¦
  - alert: HighLatency
    expr: http_response_time_p99 > 200
    for: 5m
    labels:
      severity: P1
    annotations:
      summary: "P99å»¶è¿Ÿè¶…è¿‡200ms"

  # CPUå‘Šè­¦
  - alert: HighCPU
    expr: cpu_usage > 0.8
    for: 10m
    labels:
      severity: P2
    annotations:
      summary: "CPUä½¿ç”¨ç‡è¶…è¿‡80%"
```

### 3.2 åŠ¨æ€é˜ˆå€¼ï¼ˆåŸºäºåŸºçº¿ï¼‰

**é™æ€é˜ˆå€¼çš„å±€é™**ï¼šå›ºå®šé˜ˆå€¼æ— æ³•é€‚åº”ä¸šåŠ¡æ³¢åŠ¨ã€‚æ¯”å¦‚åˆé«˜å³°QPS 10ä¸‡æ˜¯æ­£å¸¸çš„ï¼Œå‡Œæ™¨QPS 10ä¸‡å°±æ˜¯å¼‚å¸¸ã€‚åŠ¨æ€é˜ˆå€¼æ ¹æ®å†å²æ•°æ®è®¡ç®—åŸºçº¿ï¼Œåç¦»åŸºçº¿æ‰å‘Šè­¦ã€‚

**åŸºçº¿è®¡ç®—æŠ€å·§**ï¼š
- ä½¿ç”¨è¿‡å»7å¤©åŒæ—¶æ®µæ•°æ®ï¼Œèƒ½åæ˜ å‘¨æœŸæ€§è§„å¾‹
- å»æ‰æœ€é«˜å’Œæœ€ä½å€¼å†ç®—å¹³å‡ï¼Œæ’é™¤å¼‚å¸¸å¹²æ‰°
- åç¦»åŸºçº¿50%è§¦å‘å‘Šè­¦ï¼Œè¿™ä¸ªæ¯”ä¾‹æ˜¯ç»éªŒå€¼ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡è°ƒæ•´

```java
// åŠ¨æ€é˜ˆå€¼è®¡ç®—
public class DynamicThreshold {

    // è®¡ç®—åŸºçº¿ï¼ˆè¿‡å»7å¤©åŒæ—¶æ®µå‡å€¼ï¼‰
    public double calculateBaseline(String metric, LocalDateTime time) {
        List<Double> historicalValues = new ArrayList<>();

        for (int i = 1; i <= 7; i++) {
            LocalDateTime historicalTime = time.minusDays(i);
            Double value = getMetricValue(metric, historicalTime);
            if (value != null) {
                historicalValues.add(value);
            }
        }

        // å»æ‰æœ€é«˜å’Œæœ€ä½ï¼Œå–å¹³å‡å€¼
        Collections.sort(historicalValues);
        if (historicalValues.size() > 2) {
            historicalValues = historicalValues.subList(1, historicalValues.size() - 1);
        }

        return historicalValues.stream()
            .mapToDouble(Double::doubleValue)
            .average()
            .orElse(0);
    }

    // åˆ¤æ–­æ˜¯å¦å¼‚å¸¸
    public boolean isAnomaly(String metric, double currentValue) {
        double baseline = calculateBaseline(metric, LocalDateTime.now());
        double threshold = baseline * 1.5;  // åç¦»åŸºçº¿50%ä»¥ä¸Šå‘Šè­¦

        return currentValue > threshold;
    }
}
```

### 3.3 ç¯æ¯”å‘Šè­¦

```java
// ç¯æ¯”å‘Šè­¦
public class CompareAlert {

    // ä¸ä¸Šä¸€å°æ—¶å¯¹æ¯”
    public AlertResult compareWithLastHour(String metric) {
        double currentValue = getCurrentValue(metric);
        double lastHourValue = getValueOneHourAgo(metric);

        if (lastHourValue == 0) {
            return AlertResult.ok();
        }

        double changeRate = (currentValue - lastHourValue) / lastHourValue;

        if (Math.abs(changeRate) > 0.3) {  // å˜åŒ–è¶…è¿‡30%
            return AlertResult.warning(
                String.format("%s ç¯æ¯”å˜åŒ– %.1f%%", metric, changeRate * 100));
        }

        return AlertResult.ok();
    }

    // ä¸æ˜¨æ—¥åŒæœŸå¯¹æ¯”
    public AlertResult compareWithYesterday(String metric) {
        double currentValue = getCurrentValue(metric);
        double yesterdayValue = getValueYesterdaySameTime(metric);

        double changeRate = (currentValue - yesterdayValue) / yesterdayValue;

        if (Math.abs(changeRate) > 0.5) {  // å˜åŒ–è¶…è¿‡50%
            return AlertResult.warning(
                String.format("%s åŒæ¯”å˜åŒ– %.1f%%", metric, changeRate * 100));
        }

        return AlertResult.ok();
    }
}
```

---

## å››ã€å‘Šè­¦é£æš´æ²»ç†

### 4.1 å‘Šè­¦èšåˆ

**å‘Šè­¦é£æš´çš„å±å®³**ï¼šä¸€ä¸ªæ•…éšœå¯èƒ½è§¦å‘æˆç™¾ä¸Šåƒæ¡å‘Šè­¦ï¼Œè½°ç‚¸å¼é€šçŸ¥è®©äººéº»æœ¨ï¼ŒçœŸæ­£é‡è¦çš„å‘Šè­¦è¢«æ·¹æ²¡ã€‚å‘Šè­¦èšåˆæŠŠåŒç±»å‘Šè­¦åˆå¹¶ï¼Œ5åˆ†é’Ÿå†…åªå‘ä¸€æ¡ï¼Œé™„å¸¦"å·²èšåˆNæ¡"çš„ä¿¡æ¯ã€‚

**èšåˆKeyçš„è®¾è®¡**ï¼šæŒ‰"å‘Šè­¦å+æœåŠ¡+çº§åˆ«"èšåˆï¼ŒåŒä¸€ç±»é—®é¢˜åªé€šçŸ¥ä¸€æ¬¡ã€‚ä¸åŒæœåŠ¡ã€ä¸åŒçº§åˆ«çš„å‘Šè­¦åˆ†åˆ«é€šçŸ¥ï¼Œä¿è¯ä¸æ¼æŠ¥é‡è¦é—®é¢˜ã€‚

```java
// å‘Šè­¦èšåˆ
public class AlertAggregator {

    // èšåˆçª—å£ï¼š5åˆ†é’Ÿ
    private static final Duration AGGREGATE_WINDOW = Duration.ofMinutes(5);

    // èšåˆç¼“å­˜
    private Map<String, AggregatedAlert> alertCache = new ConcurrentHashMap<>();

    public void processAlert(Alert alert) {
        String aggregateKey = buildAggregateKey(alert);

        AggregatedAlert aggregated = alertCache.compute(aggregateKey, (k, v) -> {
            if (v == null || v.isExpired(AGGREGATE_WINDOW)) {
                // æ–°å‘Šè­¦æˆ–çª—å£å·²è¿‡æœŸï¼Œå‘é€å‘Šè­¦
                sendAlert(alert);
                return new AggregatedAlert(alert);
            } else {
                // çª—å£å†…ï¼Œåªè®¡æ•°ä¸å‘é€
                v.incrementCount();
                return v;
            }
        });
    }

    private String buildAggregateKey(Alert alert) {
        // æŒ‰å‘Šè­¦ç±»å‹+æœåŠ¡+çº§åˆ«èšåˆ
        return String.format("%s_%s_%s",
            alert.getAlertName(),
            alert.getService(),
            alert.getSeverity());
    }
}
```

### 4.2 å‘Šè­¦åˆ†çº§

```java
// å‘Šè­¦åˆ†çº§ä¸é€šçŸ¥ç­–ç•¥
public enum AlertSeverity {
    P0("ç´§æ€¥", Arrays.asList("phone", "sms", "wechat", "email")),
    P1("é‡è¦", Arrays.asList("sms", "wechat", "email")),
    P2("ä¸€èˆ¬", Arrays.asList("wechat", "email")),
    P3("æç¤º", Arrays.asList("email"));

    private String name;
    private List<String> channels;
}

public class AlertNotifier {

    public void notify(Alert alert) {
        AlertSeverity severity = alert.getSeverity();

        for (String channel : severity.getChannels()) {
            switch (channel) {
                case "phone":
                    phoneNotifier.call(alert.getOnCallPerson(), alert.getMessage());
                    break;
                case "sms":
                    smsNotifier.send(alert.getOnCallPerson(), alert.getMessage());
                    break;
                case "wechat":
                    wechatNotifier.send(alert.getGroup(), alert.getMessage());
                    break;
                case "email":
                    emailNotifier.send(alert.getMailList(), alert.getMessage());
                    break;
            }
        }
    }
}
```

### 4.3 å‘Šè­¦æ”¶æ•›ï¼ˆæ ¹å› åˆ†æï¼‰

**æ”¶æ•›çš„ä»·å€¼**ï¼šä¸Šæ¸¸æœåŠ¡Aæ•…éšœä¼šå¯¼è‡´ä¸‹æ¸¸æœåŠ¡Bã€Cã€Déƒ½å‘Šè­¦ï¼Œä½†æ ¹å› åªæœ‰Aã€‚å¦‚æœæ¯ä¸ªæœåŠ¡éƒ½é€šçŸ¥ï¼Œè¿ç»´è¦èŠ±æ—¶é—´åˆ¤æ–­è°æ˜¯æ ¹å› ã€‚å‘Šè­¦æ”¶æ•›é€šè¿‡ä¾èµ–å…³ç³»å›¾åˆ†æï¼Œè‡ªåŠ¨è¯†åˆ«æ ¹å› ï¼Œåªé€šçŸ¥æ ¹å› å‘Šè­¦ï¼Œå…¶ä»–å‘Šè­¦æ ‡è®°ä¸º"å…³è”å‘Šè­¦"ã€‚

**å®ç°æ€è·¯**ï¼š
1. æŒ‰æ—¶é—´æ’åºï¼Œæœ€æ—©çš„å‘Šè­¦å¯èƒ½æ˜¯æ ¹å› 
2. æ£€æŸ¥å…¶ä»–å‘Šè­¦çš„æœåŠ¡æ˜¯å¦æ˜¯æ ¹å› æœåŠ¡çš„ä¸‹æ¸¸
3. å¦‚æœæ˜¯ä¸‹æ¸¸ï¼ŒæŠŠè¿™ä¸ªå‘Šè­¦å…³è”åˆ°æ ¹å› ï¼Œä¸å•ç‹¬é€šçŸ¥

```java
// å‘Šè­¦æ”¶æ•›ï¼šè¯†åˆ«æ ¹å› 
public class AlertCorrelation {

    // ä¾èµ–å…³ç³»å›¾
    private DependencyGraph dependencyGraph;

    public List<Alert> correlate(List<Alert> alerts) {
        if (alerts.size() <= 1) {
            return alerts;
        }

        // æŒ‰æ—¶é—´æ’åº
        alerts.sort(Comparator.comparing(Alert::getTimestamp));

        // æ‰¾å‡ºæœ€æ—©çš„å‘Šè­¦ä½œä¸ºæ½œåœ¨æ ¹å› 
        Alert rootCause = alerts.get(0);

        // æ£€æŸ¥å…¶ä»–å‘Šè­¦æ˜¯å¦ç”±æ ¹å› å¯¼è‡´
        List<Alert> relatedAlerts = new ArrayList<>();
        relatedAlerts.add(rootCause);

        for (int i = 1; i < alerts.size(); i++) {
            Alert alert = alerts.get(i);

            if (isDownstream(rootCause.getService(), alert.getService())) {
                // æ˜¯ä¸‹æ¸¸æœåŠ¡çš„å‘Šè­¦ï¼Œå…³è”åˆ°æ ¹å› 
                alert.setCorrelatedTo(rootCause.getId());
                relatedAlerts.add(alert);
            }
        }

        // åªå‘é€æ ¹å› å‘Šè­¦ï¼Œé™„å¸¦å…³è”ä¿¡æ¯
        rootCause.setRelatedAlerts(relatedAlerts);
        return Collections.singletonList(rootCause);
    }

    private boolean isDownstream(String upstream, String downstream) {
        return dependencyGraph.hasPath(upstream, downstream);
    }
}
```

---

## äº”ã€æ•…éšœå®šä½æ–¹æ³•

### 5.1 åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª

```java
// é“¾è·¯è¿½è¸ªåŸ‹ç‚¹
public class TraceInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request,
            HttpServletResponse response, Object handler) {
        // ç”Ÿæˆæˆ–ç»§æ‰¿TraceId
        String traceId = request.getHeader("X-Trace-Id");
        if (traceId == null) {
            traceId = UUID.randomUUID().toString();
        }

        // ç”ŸæˆSpanId
        String spanId = UUID.randomUUID().toString().substring(0, 8);

        // è®¾ç½®åˆ°ä¸Šä¸‹æ–‡
        TraceContext.setTraceId(traceId);
        TraceContext.setSpanId(spanId);

        // è®°å½•å¼€å§‹æ—¶é—´
        TraceContext.setStartTime(System.currentTimeMillis());

        return true;
    }

    @Override
    public void afterCompletion(HttpServletRequest request,
            HttpServletResponse response, Object handler, Exception ex) {
        // è®°å½•é“¾è·¯ä¿¡æ¯
        TraceSpan span = new TraceSpan();
        span.setTraceId(TraceContext.getTraceId());
        span.setSpanId(TraceContext.getSpanId());
        span.setService("product-service");
        span.setOperation(request.getRequestURI());
        span.setDuration(System.currentTimeMillis() - TraceContext.getStartTime());
        span.setStatus(response.getStatus());

        // å‘é€åˆ°é“¾è·¯æ”¶é›†å™¨
        traceCollector.collect(span);

        // æ¸…ç†ä¸Šä¸‹æ–‡
        TraceContext.clear();
    }
}
```

### 5.2 æ—¥å¿—å…³è”åˆ†æ

```java
// ç»Ÿä¸€æ—¥å¿—æ ¼å¼
@Aspect
@Component
public class LogAspect {

    @Around("@annotation(LogMethod)")
    public Object logMethod(ProceedingJoinPoint pjp) throws Throwable {
        String traceId = TraceContext.getTraceId();
        String method = pjp.getSignature().getName();
        Object[] args = pjp.getArgs();

        long startTime = System.currentTimeMillis();

        try {
            Object result = pjp.proceed();

            log.info("[{}] {} æˆåŠŸ, å‚æ•°={}, è€—æ—¶={}ms",
                traceId, method, JSON.toJSONString(args),
                System.currentTimeMillis() - startTime);

            return result;

        } catch (Exception e) {
            log.error("[{}] {} å¤±è´¥, å‚æ•°={}, å¼‚å¸¸={}",
                traceId, method, JSON.toJSONString(args), e.getMessage(), e);
            throw e;
        }
    }
}

// æ—¥å¿—æŸ¥è¯¢
public class LogSearchService {

    // æ ¹æ®TraceIdæŸ¥è¯¢å®Œæ•´é“¾è·¯æ—¥å¿—
    public List<LogEntry> searchByTraceId(String traceId) {
        return esClient.search("logs")
            .query(QueryBuilders.termQuery("traceId", traceId))
            .sort("timestamp", SortOrder.ASC)
            .execute();
    }

    // æ ¹æ®é”™è¯¯ç±»å‹èšåˆ
    public Map<String, Long> aggregateErrors(Duration window) {
        return esClient.search("logs")
            .query(QueryBuilders.rangeQuery("timestamp")
                .gte("now-" + window.toMinutes() + "m"))
            .aggregation("errors", "level", "ERROR")
            .groupBy("exceptionType")
            .execute();
    }
}
```

### 5.3 æ•…éšœå®šä½æµç¨‹

```
æ•…éšœå®šä½æ ‡å‡†æµç¨‹ï¼š

1. ç¡®è®¤æ•…éšœç°è±¡
   â”œâ”€ æŸ¥çœ‹ç›‘æ§å¤§ç›˜ï¼Œç¡®è®¤å¼‚å¸¸æŒ‡æ ‡
   â”œâ”€ ç¡®è®¤å½±å“èŒƒå›´ï¼ˆç”¨æˆ·æ•°ã€åŠŸèƒ½èŒƒå›´ï¼‰
   â””â”€ ç¡®è®¤æ•…éšœå¼€å§‹æ—¶é—´

2. åˆæ­¥å®šä½
   â”œâ”€ æŸ¥çœ‹æœ€è¿‘å˜æ›´ï¼ˆå‘å¸ƒã€é…ç½®å˜æ›´ï¼‰
   â”œâ”€ æŸ¥çœ‹ä¾èµ–æœåŠ¡çŠ¶æ€
   â””â”€ æŸ¥çœ‹åŸºç¡€è®¾æ–½çŠ¶æ€ï¼ˆCPUã€å†…å­˜ã€ç½‘ç»œï¼‰

3. æ·±å…¥åˆ†æ
   â”œâ”€ æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼Œå®šä½å¼‚å¸¸å †æ ˆ
   â”œâ”€ æŸ¥çœ‹é“¾è·¯è¿½è¸ªï¼Œå®šä½æ…¢èŠ‚ç‚¹
   â””â”€ æŸ¥çœ‹æ•°æ®åº“æ…¢æŸ¥è¯¢

4. ç¡®è®¤æ ¹å› 
   â”œâ”€ éªŒè¯å‡è®¾
   â””â”€ åˆ¶å®šä¿®å¤æ–¹æ¡ˆ

5. ä¿®å¤ä¸éªŒè¯
   â”œâ”€ æ‰§è¡Œä¿®å¤ï¼ˆå›æ»š/é‡å¯/æ‰©å®¹ç­‰ï¼‰
   â””â”€ éªŒè¯æ¢å¤
```

---

## å…­ã€ç»å…¸æ•…éšœæ¡ˆä¾‹

### 6.1 æ¡ˆä¾‹1ï¼šP99æ¯›åˆºé—®é¢˜

**é—®é¢˜ç°è±¡ï¼š**
- å¹³å‡RTæ­£å¸¸ï¼ˆ20msï¼‰
- P99å¶å°”é£™å‡åˆ°500ms+
- æ²¡æœ‰æ˜æ˜¾è§„å¾‹

**æ’æŸ¥è¿‡ç¨‹ï¼š**
```
1. æŸ¥çœ‹ç›‘æ§å¤§ç›˜
   - å‘ç°P99æ¯›åˆºå’ŒGCæ—¶é—´æœ‰ç›¸å…³æ€§
   - GCæ—¶å‘ç”ŸP99é£™å‡

2. åˆ†æGCæ—¥å¿—
   - å‘ç°æœ‰Full GCï¼Œæ¯æ¬¡çº¦300ms
   - Full GCé¢‘ç‡ï¼šæ¯å°æ—¶1-2æ¬¡

3. åˆ†æå †å†…å­˜
   - ä½¿ç”¨MATåˆ†æå †dump
   - å‘ç°å¤§å¯¹è±¡ï¼šå•†å“åˆ—è¡¨è¿”å›çš„JSONæ•°æ®

4. å®šä½ä»£ç 
   - æŸæ¥å£ä¸€æ¬¡è¿”å›1000ä¸ªå•†å“
   - å•æ¬¡JSONå¤§å°çº¦5MB
   - ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œè§¦å‘Full GC
```

**è§£å†³æ–¹æ¡ˆï¼š**
```java
// ä¼˜åŒ–å‰ï¼šä¸€æ¬¡è¿”å›æ‰€æœ‰å•†å“
public List<Product> getAllProducts(Long merchantId) {
    return productDao.selectByMerchantId(merchantId);  // å¯èƒ½è¿”å›æ•°åƒä¸ª
}

// ä¼˜åŒ–åï¼šåˆ†é¡µ + æµå¼è¿”å›
public PageResult<Product> getProducts(Long merchantId, int page, int size) {
    // é™åˆ¶å•é¡µå¤§å°
    size = Math.min(size, 100);
    return productDao.selectByPage(merchantId, page, size);
}

// åŒæ—¶è°ƒæ•´JVMå‚æ•°
// -XX:PretenureSizeThreshold=1m  // å¤§äº1MBæ‰è¿›è€å¹´ä»£
// -XX:MaxGCPauseMillis=50        // ç›®æ ‡GCåœé¡¿50ms
```

### 6.2 æ¡ˆä¾‹2ï¼šæ•°æ®åº“è¿æ¥æ± è€—å°½

**é—®é¢˜ç°è±¡ï¼š**
- è¯·æ±‚å¤§é‡è¶…æ—¶
- é”™è¯¯æ—¥å¿—æ˜¾ç¤º"Cannot acquire connection from pool"

**æ’æŸ¥è¿‡ç¨‹ï¼š**
```
1. æŸ¥çœ‹è¿æ¥æ± ç›‘æ§
   - æ´»è·ƒè¿æ¥æ•°ï¼š200ï¼ˆç­‰äºæœ€å¤§å€¼ï¼‰
   - ç­‰å¾…çº¿ç¨‹æ•°ï¼š500+

2. æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—
   - å‘ç°å¤§é‡æ…¢æŸ¥è¯¢ï¼ˆ>1ç§’ï¼‰
   - SQL: SELECT * FROM product WHERE name LIKE '%xxx%'

3. åˆ†æSQL
   - LIKE '%xxx%' å¯¼è‡´å…¨è¡¨æ‰«æ
   - è¡¨æ•°æ®é‡500ä¸‡ï¼Œå•æ¬¡æŸ¥è¯¢2-3ç§’

4. å®šä½ä»£ç 
   - å•†å“æœç´¢æ¥å£ï¼Œæœªèµ°ESï¼Œç›´æ¥æŸ¥DB
   - å‰å‡ å¤©çš„å˜æ›´å¼•å…¥çš„bug
```

**è§£å†³æ–¹æ¡ˆï¼š**
```java
// 1. ç´§æ€¥å›æ»šä»£ç 

// 2. ä¼˜åŒ–è¿æ¥æ± é…ç½®
HikariConfig config = new HikariConfig();
config.setMaximumPoolSize(200);
config.setConnectionTimeout(3000);  // è·å–è¿æ¥è¶…æ—¶3ç§’
config.setLeakDetectionThreshold(30000);  // è¿æ¥æ³„æ¼æ£€æµ‹

// 3. å¢åŠ SQLæ‰§è¡Œè¶…æ—¶
config.addDataSourceProperty("socketTimeout", "5000");  // SQLæ‰§è¡Œè¶…æ—¶5ç§’

// 4. å¢åŠ æ…¢SQLå‘Šè­¦
@Scheduled(fixedRate = 60000)
public void checkSlowQuery() {
    List<SlowQuery> slowQueries = getSlowQueries(Duration.ofMinutes(1));
    if (slowQueries.size() > 10) {
        alertService.send("æ…¢æŸ¥è¯¢æ•°é‡å¼‚å¸¸ï¼š" + slowQueries.size());
    }
}
```

### 6.3 æ¡ˆä¾‹3ï¼šç¼“å­˜å‡»ç©¿

**é—®é¢˜ç°è±¡ï¼š**
- DBè´Ÿè½½çªç„¶é£™å‡
- å¤§é‡è¯·æ±‚è¶…æ—¶
- å‘ç”Ÿåœ¨æŸå•†å“ä¿ƒé”€å¼€å§‹æ—¶

**æ’æŸ¥è¿‡ç¨‹ï¼š**
```
1. æŸ¥çœ‹DBç›‘æ§
   - QPSä»1000é£™å‡åˆ°10000
   - ä¸»è¦æ˜¯productè¡¨çš„æŸ¥è¯¢

2. æŸ¥çœ‹ç¼“å­˜ç›‘æ§
   - å‘½ä¸­ç‡ä»95%é™åˆ°20%
   - å¤§é‡ç¼“å­˜miss

3. åˆ†æç¼“å­˜key
   - ä¿ƒé”€å•†å“çš„ç¼“å­˜åŒæ—¶è¿‡æœŸ
   - è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºä¿ƒé”€å¼€å§‹æ—¶é—´

4. å®šä½é—®é¢˜
   - è¿è¥é…ç½®ä¿ƒé”€æ—¶ï¼Œå°†ç¼“å­˜è¿‡æœŸæ—¶é—´è®¾ä¸ºä¿ƒé”€å¼€å§‹æ—¶é—´
   - å¯¼è‡´ä¿ƒé”€å¼€å§‹æ—¶ï¼Œå¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆ
```

**è§£å†³æ–¹æ¡ˆï¼š**
```java
// 1. ç´§æ€¥æ‰‹åŠ¨é¢„çƒ­ç¼“å­˜

// 2. å¢åŠ ç¼“å­˜è¿‡æœŸæ—¶é—´éšæœºåŒ–
public void cacheProduct(Long productId, Product product) {
    // åŸºç¡€è¿‡æœŸæ—¶é—´ + éšæœºå€¼ï¼Œé¿å…åŒæ—¶è¿‡æœŸ
    int ttl = BASE_TTL + random.nextInt(300);  // 5åˆ†é’Ÿéšæœºå€¼
    redisTemplate.opsForValue().set(
        "product:" + productId, product, ttl, TimeUnit.SECONDS);
}

// 3. å¢åŠ äº’æ–¥é”ï¼Œé˜²æ­¢ç¼“å­˜å‡»ç©¿
public Product getProduct(Long productId) {
    Product product = cache.get(productId);
    if (product != null) {
        return product;
    }

    // ç¼“å­˜missï¼ŒåŠ é”æŸ¥è¯¢
    String lockKey = "lock:product:" + productId;
    if (redisLock.tryLock(lockKey, 5, TimeUnit.SECONDS)) {
        try {
            // åŒé‡æ£€æŸ¥
            product = cache.get(productId);
            if (product != null) {
                return product;
            }

            // æŸ¥è¯¢DB
            product = productDao.selectById(productId);
            cache.put(productId, product);
            return product;
        } finally {
            redisLock.unlock(lockKey);
        }
    } else {
        // è·å–é”å¤±è´¥ï¼Œç­‰å¾…åé‡è¯•
        Thread.sleep(100);
        return getProduct(productId);
    }
}
```

---

## ä¸ƒã€ç›‘æ§å¤§ç›˜è®¾è®¡

### 7.1 æ ¸å¿ƒå¤§ç›˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å•†å“ç³»ç»Ÿç›‘æ§å¤§ç›˜                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•´ä½“çŠ¶æ€ï¼šğŸŸ¢ æ­£å¸¸                        æ›´æ–°æ—¶é—´ï¼š10:30:00 â”‚
â”‚                                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ æ ¸å¿ƒæŒ‡æ ‡                                              â”‚â”‚
â”‚ â”‚ QPS: 85.6ä¸‡   é”™è¯¯ç‡: 0.02%   P99: 42ms              â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ â”‚ QPSè¶‹åŠ¿            â”‚ â”‚ RTè¶‹åŠ¿              â”‚          â”‚
â”‚ â”‚ [è¶‹åŠ¿å›¾]           â”‚ â”‚ [è¶‹åŠ¿å›¾]            â”‚          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ â”‚ é”™è¯¯ç‡è¶‹åŠ¿         â”‚ â”‚ ç¼“å­˜å‘½ä¸­ç‡          â”‚          â”‚
â”‚ â”‚ [è¶‹åŠ¿å›¾]           â”‚ â”‚ L1: 32% L2: 60%    â”‚          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                          â”‚
â”‚ ä¾èµ–æœåŠ¡çŠ¶æ€ï¼š                                            â”‚
â”‚ â”œâ”€ MySQL: ğŸŸ¢ æ­£å¸¸  è¿æ¥æ•°: 150/200                       â”‚
â”‚ â”œâ”€ Redis: ğŸŸ¢ æ­£å¸¸  å‘½ä¸­ç‡: 92%                           â”‚
â”‚ â”œâ”€ ES:    ğŸŸ¢ æ­£å¸¸  QPS: 15ä¸‡                             â”‚
â”‚ â””â”€ MQ:    ğŸŸ¢ æ­£å¸¸  å †ç§¯: 0                               â”‚
â”‚                                                          â”‚
â”‚ æœ€è¿‘å‘Šè­¦ï¼š                                                â”‚
â”‚ â””â”€ æš‚æ— å‘Šè­¦                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 æ¥å£çº§å¤§ç›˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ¥å£ç›‘æ§æ˜ç»†                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ æ¥å£         â”‚  QPS   â”‚  P50  â”‚  P99  â”‚ é”™è¯¯ç‡    â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ /product/listâ”‚ 45ä¸‡   â”‚ 15ms  â”‚ 35ms  â”‚ 0.01%    â”‚  â”‚
â”‚ â”‚ /product/get â”‚ 30ä¸‡   â”‚ 10ms  â”‚ 25ms  â”‚ 0.02%    â”‚  â”‚
â”‚ â”‚ /product/searchâ”‚ 8ä¸‡  â”‚ 50ms  â”‚ 120ms â”‚ 0.05%    â”‚  â”‚
â”‚ â”‚ /product/updateâ”‚ 2ä¸‡  â”‚ 30ms  â”‚ 80ms  â”‚ 0.03%    â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚ é€‰ä¸­æ¥å£ï¼š/product/list                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ [è¯¦ç»†RTåˆ†å¸ƒå›¾]                                        â”‚â”‚
â”‚ â”‚ [é”™è¯¯ç±»å‹åˆ†å¸ƒ]                                        â”‚â”‚
â”‚ â”‚ [è°ƒç”¨é“¾è·¯ç¤ºä¾‹]                                        â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…«ã€æœ€ä½³å®è·µ

### 8.1 ç›‘æ§åŸåˆ™

```
1. å…¨é¢è¦†ç›–
   - ä»ä¸šåŠ¡åˆ°åŸºç¡€è®¾æ–½ï¼Œæ¯å±‚éƒ½è¦ç›‘æ§
   - æ ¸å¿ƒé“¾è·¯æ¯ä¸ªç¯èŠ‚éƒ½è¦æœ‰æŒ‡æ ‡

2. å¿«é€Ÿå‘ç°
   - å‘Šè­¦å»¶è¿Ÿ < 1åˆ†é’Ÿ
   - è‡ªåŠ¨åŒ–å‘Šè­¦ï¼Œä¸ä¾èµ–äººå·¥å·¡æ£€

3. å¿«é€Ÿå®šä½
   - é“¾è·¯è¿½è¸ªè¦†ç›–æ‰€æœ‰æœåŠ¡
   - æ—¥å¿—è§„èŒƒï¼Œæ”¯æŒå…³è”æŸ¥è¯¢

4. å¿«é€Ÿæ¢å¤
   - æœ‰é¢„æ¡ˆï¼ŒçŸ¥é“æ€ä¹ˆå¤„ç†
   - æœ‰å›æ»šèƒ½åŠ›ï¼Œèƒ½å¿«é€Ÿæ­¢è¡€
```

### 8.2 å‘Šè­¦è®¾ç½®åŸåˆ™

```
1. å‘Šè­¦è¦å‡†ç¡®
   - é¿å…è¯¯æŠ¥ï¼ˆç‹¼æ¥äº†æ•ˆåº”ï¼‰
   - å‘Šè­¦äº†å°±ä¸€å®šè¦å¤„ç†

2. å‘Šè­¦è¦å¯æ‰§è¡Œ
   - å‘Šè­¦ä¿¡æ¯è¦æ¸…æ™°
   - è¦æœ‰å¤„ç†å»ºè®®

3. å‘Šè­¦è¦åˆ†çº§
   - ä¸æ˜¯æ‰€æœ‰é—®é¢˜éƒ½ç´§æ€¥
   - é¿å…å‘Šè­¦ç–²åŠ³

4. å‘Šè­¦è¦é—­ç¯
   - å‘Šè­¦è¦æœ‰äººå“åº”
   - å“åº”è¦æœ‰è®°å½•
```
